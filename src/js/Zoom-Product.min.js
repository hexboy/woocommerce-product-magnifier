(function($) {
	// console.log('iplug zoom main script is running');
	var removeZoomZrea = 0;
	var mousePos = { X: 0, Y: 0 };
	var largeImage = { width: 0, height: 0, src: '', ratioW: 1, ratioH: 1 };
	// console.log(ipzo);

	// initail 
	$('<div id="image-zoom-area"></div>').appendTo($('body'));
	$('#image-zoom-area').hide();
	if (ipzo.transparent) $('#image-zoom-area').addClass('transparent');
	$('#image-zoom-area').hover(function() { clearTimeout(removeZoomZrea); }, function() {
		removeZoomZrea = setTimeout(function() {
			$('#image-zoom-area').hide();
		}, 200);
	});

	$('figure.woocommerce-product-gallery__wrapper > div').hover(
		// mouse enter
		function() {
			if ($(window).width() < 768) return;
			// check is main image
			if (!$(this).is(':first-child')) return;
			var img = $(this).find('a > img');
			clearTimeout(removeZoomZrea);
			// check have image src link
			largeImage.src = img.attr('data-large_image');
			// console.log(largeImage.src);

			largeImage.width = img.attr('data-large_image_width') * ipzo.zoomLevel;
			largeImage.height = img.attr('data-large_image_height') * ipzo.zoomLevel;
			largeImage.ratioW = largeImage.width / img.width();
			largeImage.ratioH = largeImage.height / img.height();

			$('#image-zoom-area').show();
			$('#image-zoom-area').css({
				width: ipzo.zoomSize,
				height: ipzo.zoomSize,
				borderRadius: (ipzo.iscircle) ? '50%' : 0,
				backgroundImage: 'url(' + largeImage.src + '),url(' + ipzo.bg + ')',
				backgroundSize: largeImage.width + 'px ' + largeImage.height + 'px' + ',155px 155px',
				backgroundRepeat: 'no-repeat, repeat',
			});

		},
		// mouse out
		function() {
			removeZoomZrea = setTimeout(function() {
				$('#image-zoom-area').hide();
			}, 200);

		});

	$('figure.woocommerce-product-gallery__wrapper > div').mousemove(function(e) {
		if ($(window).width() < 768) return;
		// check is main image
		if (!$(this).is(':first-child')) return;


		// set magnifier position
		// method 1
		var imageOffset = $(this).find('> a img').offset();
		// mousePos.X = Math.round(e.pageX - imageOffset.left);
		// mousePos.Y = Math.round(e.pageY - imageOffset.top);

		// method 2
		mousePos.X = Math.round(e.pageX - $(document).scrollLeft());
		mousePos.Y = Math.round(e.pageY - $(document).scrollTop());

		$('#image-zoom-area').css({ top: mousePos.Y, left: mousePos.X });

		// set magnifier background position
		var backgroundX = -1 * (e.pageX - imageOffset.left) * largeImage.ratioW + ipzo.zoomSize / 2;
		var backgroundY = -1 * (e.pageY - imageOffset.top) * largeImage.ratioH + ipzo.zoomSize / 2;
		backgroundX = Math.round(backgroundX);
		backgroundY = Math.round(backgroundY);
		$('#image-zoom-area').css("background-position", backgroundX + "px " + backgroundY + "px");
		// console.log(largeImage);
		// console.log(backgroundX, backgroundY);

	});

})(jQuery);